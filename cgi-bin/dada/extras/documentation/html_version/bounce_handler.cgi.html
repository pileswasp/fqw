<?xml version="1.0" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Bounce Handler</title>
<link rel="stylesheet" href="/Users/justin/Documents/DadaMail/build/tmp/dada/extras/documentation/pod_source/pod_styles.css" type="text/css" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rev="made" href="mailto:vxd@glow.apple.com" />
</head>

<body>



<ul id="index">
  <li><a href="#Name">Name</a></li>
  <li><a href="#User-Guide">User Guide</a></li>
  <li><a href="#Description">Description</a></li>
  <li><a href="#Obtaining-a-Copy-of-the-Plugin">Obtaining a Copy of the Plugin</a></li>
  <li><a href="#Requirements">Requirements</a></li>
  <li><a href="#Recommended">Recommended</a></li>
  <li><a href="#Installation">Installation</a></li>
  <li><a href="#Lightning-Configuration-Installation-Instructions">Lightning Configuration/Installation Instructions</a></li>
  <li><a href="#Screencasts">Screencasts</a>
    <ul>
      <li><a href="#Part-1">Part 1</a></li>
      <li><a href="#Part-2">Part 2</a></li>
    </ul>
  </li>
  <li><a href="#Configuration">Configuration</a>
    <ul>
      <li>
        <ul>
          <li><a href="#POP3-Server-Information">POP3 Server Information.</a></li>
        </ul>
      </li>
      <li><a href="#Set-this-address-as-the-default-List-Administration-Email-Address">Set this address as the default List Administration Email Address</a></li>
      <li><a href="#List-Control-Panel-Menu">List Control Panel Menu</a></li>
      <li><a href="#Telling-Dada-Mail-to-use-Bounce-Handler">Telling Dada Mail to use Bounce Handler.</a>
        <ul>
          <li><a href="#If-youre-using-th-sendmail-command">If you&#39;re using th sendmail command:</a></li>
          <li><a href="#If-youre-using-SMTP-sending">If you&#39;re using SMTP sending:</a></li>
          <li><a href="#If-youre-using-Amazon-SES">If you&#39;re using Amazon SES:</a></li>
        </ul>
      </li>
      <li><a href="#Testing">Testing</a></li>
    </ul>
  </li>
  <li><a href="#Configuring-the-Cronjob-to-Automatically-Run-Bounce-Handler">Configuring the Cronjob to Automatically Run Bounce Handler</a>
    <ul>
      <li><a href="#Setting-the-cronjob-via-curl">Setting the cronjob via curl</a>
        <ul>
          <li><a href="#Customizing-your-cronjob-with-added-parameters">Customizing your cronjob with added parameters</a>
            <ul>
              <li><a href="#passcode">passcode</a></li>
            </ul>
          </li>
          <li><a href="#messages">messages</a></li>
          <li><a href="#verbose">verbose</a></li>
          <li><a href="#test">test</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#Command-Line-Interface">Command Line Interface</a>
    <ul>
      <li><a href="#Command-Line-Interface-for-Cronjobs">Command Line Interface for Cronjobs:</a></li>
    </ul>
  </li>
  <li><a href="#Plugin-Configs">Plugin Configs</a>
    <ul>
      <li><a href="#Server-Username-Password">Server, Username, Password</a></li>
      <li><a href="#Port">Port</a></li>
      <li><a href="#USESSL">USESSL</a></li>
      <li><a href="#AUTH_MODE">AUTH_MODE</a></li>
      <li><a href="#Plugin_Name">Plugin_Name</a></li>
      <li><a href="#Plugin_URL">Plugin_URL</a></li>
      <li><a href="#Allow_Manual_Run">Allow_Manual_Run</a></li>
      <li><a href="#Manual_Run_Passcode">Manual_Run_Passcode</a></li>
      <li><a href="#Enable_POP3_File_Locking">Enable_POP3_File_Locking</a></li>
      <li><a href="#Log">Log</a></li>
      <li><a href="#MessagesAtOnce">MessagesAtOnce</a>
        <ul>
          <li><a href="#Max_Size_Of_Any_Message">Max_Size_Of_Any_Message</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#More-on-Scores-Thresholds-etc">More on Scores, Thresholds, etc</a></li>
  <li><a href="#Special-Debugging-Mode">Special Debugging Mode</a>
    <ul>
      <li><a href="#manually_enter_bounces">manually_enter_bounces</a></li>
    </ul>
  </li>
  <li><a href="#FAQs">FAQs</a>
    <ul>
      <li><a href="#Bounce-Email-Address">Bounce Email Address</a>
        <ul>
          <li><a href="#Do-you-use-only-one-Bounce-Email-Address-for-all-the-mailing-lists">Do you use only one Bounce Email Address for all the mailing lists?</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#Introduction-to-Bounce-Handler-Rules">Introduction to Bounce Handler Rules</a>
    <ul>
      <li><a href="#Customizing-Bounce-Handler-Rules">Customizing Bounce Handler Rules</a></li>
    </ul>
  </li>
  <li><a href="#COPYRIGHT">COPYRIGHT</a></li>
</ul>

<h1 id="Name">Name</h1>

<p>Bounce Handler for Dada Mail</p>

<h1 id="User-Guide">User Guide</h1>

<p>For a guide on using Bounce Handler, see the <b>Dada Mail Manual</b>:</p>

<p><a href="http://dadamailproject.com/pro_dada/using_bounce_handler.html">http://dadamailproject.com/pro_dada/using_bounce_handler.html</a></p>

<p>For more information on Pro Dada/Dada Mail Manual:</p>

<p><a href="http://dadamailproject.com/purchase/pro.html">http://dadamailproject.com/purchase/pro.html</a></p>

<h1 id="Description">Description</h1>

<p>Bounce Handler intelligently handles bounces from Dada Mail list messages.</p>

<p>Messages sent to subscribers of your mailing list that bounce back will be directed to the <b>List Administrator Address</b>. This email account is then checked periodically by Bounce Handler.</p>

<p>Bounce Handler then reads awaiting messages and <b>parses</b> the messages in an attempt to understand why the message has bounced.</p>

<p>The <b>parsed</b> message will then be <b>examined</b> and an <b>action</b> will be taken.</p>

<p>The usual action that is taken is to apply a <b>score</b> to the email address that has bounced the message. Once the <b>Score Threshold</b> is reached, the email address is unsubscribed from the mailing list.</p>

<h1 id="Obtaining-a-Copy-of-the-Plugin">Obtaining a Copy of the Plugin</h1>

<p>Bounce Handler is located in the, <i>dada/plugins</i> directory of the main Dada Mail distribution, under the name, <b>bounce_handler.cgi</b></p>

<h1 id="Requirements">Requirements</h1>

<p>Please make sure you have these requirements before installing this plugin:</p>

<ul>

<li><p>A POP3 Email Account</p>

<p>Bounce Handler works by checking a email address via POP3. (IMAP is currently not supported).</p>

<p>You will need to create a new email address account for Bounce Handler to utilize.</p>

<p>Example: create <b>bounces@yourdomain.com</b>, where, <i>yourdomain.com</i> is the name of the domain Dada Mail is installed on.</p>

<p>Guidelines on this address:</p>

<ul>

<li><p>Do NOT use this address for anything except Bounce Handler</p>

<p>No one will be checking this POP3 account via a mail reader.</p>

<p>Doing so won&#39;t break Dada Mail, but it will stop Bounce Handler from working correctly, if when checking messages, your mail reader then removes those messages from the POP3 account. If you do need to periodically check this inbox, make sure to have your mail reader set to <b>not</b> automatically remove the messages.</p>

</li>
<li><p>The email address MUST belong to the domain you have Dada Mail installed</p>

<p>Meaning, if your domain is, &quot;yourdomain.com&quot;, the bounce email address should be something like, &quot;bounces@yourdomain.com&quot;. In other words, do not use a Yahoo! Gmail, or Hotmail account for your bounce address. This will most likely disrupt all regular mail sending in Dada Mail.</p>

</li>
<li><p>Bounce Handler MUST be able to check the POP3 account</p>

<p>Check to make sure that the POP3 server (usually, port 110) is not blocked from requests coming from your hosting account server.</p>

</li>
</ul>

</li>
</ul>

<h1 id="Recommended">Recommended</h1>

<p>These points are not required, but recommended to use Bounce Handler:</p>

<ul>

<li><p>Ability to set Cron Jobs.</p>

<p>Bounce Handler can be configured to run automatically by using a cronjob.</p>

<p>If you do not know how to set up a cronjob, attempting to set one up for Dada Mail will result in much aggravation. Please read up on the topic before attempting!</p>

</li>
</ul>

<h1 id="Installation">Installation</h1>

<p>This plugin can be installed during a Dada Mail install/upgrade, using the included installer that comes with Dada Mail. The below installation instructions go through how to install the plugin <b>manually</b>. We suggest using the Dada Mail Installer.</p>

<p>If you do install this way, note that you still have to create the create the Bounce Handler email account as well set the cronjob. Both are covered below.</p>

<h1 id="Lightning-Configuration-Installation-Instructions">Lightning Configuration/Installation Instructions</h1>

<ul>

<li><p>Create the bounce handler email account</p>

</li>
<li><p>Configure your mailing list to use this email address for its, &quot;List Administrator Address&quot;</p>

<p>Set this email address as our &quot;List Administrator Address&quot; in the list control panel, under,</p>

<p><b>Your Mailing List - List Information</b></p>

</li>
<li><p>Configure the plugin in your .dada_config file</p>

<p>(covered below)</p>

</li>
<li><p>chmod 755 the bounce_handler.cgi script</p>

</li>
<li><p>visit the plugin via a web browser.</p>

</li>
<li><p>Set the cronjob (optional)</p>

</li>
</ul>

<h1 id="Screencasts">Screencasts</h1>

<h2 id="Part-1">Part 1</h2>

<p><a href="https://www.youtube.com/watch?v=tvdIj1s19Vo">https://www.youtube.com/watch?v=tvdIj1s19Vo</a></p>

<h2 id="Part-2">Part 2</h2>

<p><a href="https://www.youtube.com/watch?v=CnsM994xa7A">https://www.youtube.com/watch?v=CnsM994xa7A</a></p>

<h1 id="Configuration">Configuration</h1>

<p>There&#39;s a few things you need to configure for this plugin. Configure the plugin variables in your <code>.dada_config</code> file (not in the plugin itself!)</p>

<h3 id="POP3-Server-Information">POP3 Server Information.</h3>

<p>Create a new POP3 email account. This email account will be the address that bounced messages will be delivered to.</p>

<p>Open up your <code>.dada_config</code> file for editing.</p>

<p>Search and see if the following lines are present:</p>

<pre><code> # start cut for plugin configs
 =cut

 =cut
 # end cut for plugin configs</code></pre>

<p>If they are present, remove them.</p>

<p>You can then configure the plugin variables on these lines:</p>

<pre><code>        Bounce_Handler =&gt; { 
        
            Server                                      =&gt; undef, 
            Username                                    =&gt; undef, 
            Password                                    =&gt; undef, 
            # etc.
        },
        </code></pre>

<p>For example:</p>

<p>Bounce_Handler =&gt; {</p>

<pre><code>                Server                                          =&gt; &#39;mail.yourdomain.com&#39;, 
                Username                                        =&gt; &#39;bounces+yourdomain.com&#39;, 
                Password                                        =&gt; &#39;password&#39;, 
            # etc.
},</code></pre>

<h2 id="Set-this-address-as-the-default-List-Administration-Email-Address">Set this address as the default List Administration Email Address</h2>

<p>You may also want to set a default value for the, List Adminstration Email, so that all new lists already have Bounce Handler enabled.</p>

<p>Find this chunk of lines in your <code>.dada_config</code> file:</p>

<pre><code>        # start cut for list settings defaults
        =cut
        
        %LIST_SETUP_INCLUDE = (
                set_smtp_sender              =&gt; 1, # For SMTP   
                add_sendmail_f_flag          =&gt; 1, # For Sendmail Command
                admin_email                  =&gt; &#39;bounces@example.com&#39;,
        );
        
        =cut
        # end cut for list settings defaults</code></pre>

<p>Remove the =cut lines, similar to before:</p>

<pre><code>        # start cut for list settings defaults
        =cut

        =cut
        # end cut for list settings defaults</code></pre>

<p>And then change the, <code>admin_email</code> to your bounce handler email address:</p>

<pre><code>        %LIST_SETUP_INCLUDE = (
                set_smtp_sender              =&gt; 1, # For SMTP   
                add_sendmail_f_flag          =&gt; 1, # For Sendmail Command
                admin_email                  =&gt; &#39;bounces@yourdomain.com&#39;,
        );</code></pre>

<h2 id="List-Control-Panel-Menu">List Control Panel Menu</h2>

<p>Now, edit your <code>.dada_config</code> file, so that it shows Bounce Handler in the left-hand menu, under the, <b>Plugins</b> heading:</p>

<p>First, see if the following lines are present in your <code>.dada_config</code> file:</p>

<pre><code> # start cut for list control panel menu
 =cut

 =cut
 # end cut for list control panel menu</code></pre>

<p>If they are, remove them.</p>

<p>Then, find these lines:</p>

<pre><code> #                                      {-Title      =&gt; &#39;Bounce Handler&#39;,
 #                                       -Title_URL  =&gt; $PLUGIN_URL.&quot;/bounce_handler.cgi&quot;,
 #                                       -Function   =&gt; &#39;bounce_handler&#39;,
 #                                       -Activated  =&gt; 1,
 #                                      },</code></pre>

<p>Uncomment the lines, by taking off the, &quot;#&quot;&#39;s:</p>

<pre><code>                                        {-Title      =&gt; &#39;Bounce Handler&#39;,
                                         -Title_URL  =&gt; $PLUGIN_URL.&quot;/bounce_handler.cgi&quot;,
                                         -Function   =&gt; &#39;bounce_handler&#39;,
                                         -Activated  =&gt; 1,
                                        },</code></pre>

<p>Save your <code>.dada_config</code> file.</p>

<h2 id="Telling-Dada-Mail-to-use-Bounce-Handler">Telling Dada Mail to use Bounce Handler.</h2>

<p>You&#39;re going to have to tell Dada Mail explicitly that you want bounces to go to the bounce handler. The first step is to set the <b>Dada List Administrator</b> to your bounce email address. You&#39;ll set this per mailing list in the each mailing list&#39;s control panel, under</p>

<p><b>Your Mailing List - List Information</b></p>

<p>After that, you&#39;ll need to configure outgoing email messages to set the <b>Dada List Administrator</b> address in the <code>Return-Path</code> header. Sounds scary, but it&#39;s easy enough.</p>

<h3 id="If-youre-using-th-sendmail-command">If you&#39;re using th sendmail command:</h3>

<p>In the list control panel, go to <b>Mail Sending - Sending Options</b> and check: <b>Add the Sendmail &#39;-f&#39; flag when sending messages ...</b></p>

<p>This <i>should</i> set the sending to the admin email, and in turn, set the <b>Return-Path</b> header. Dada Mail is shipped to have this option set by default.</p>

<h3 id="If-youre-using-SMTP-sending">If you&#39;re using SMTP sending:</h3>

<p>In the list control panel, go to: <b>Mail Sending - Sending Options</b> and check the box labeled: <b>Set the Sender of SMTP mailings to the list administration email address</b> Dada Mail is shipped to have this option set by default.</p>

<h3 id="If-youre-using-Amazon-SES">If you&#39;re using Amazon SES:</h3>

<p>Dada Mail will automatically have bounces go to the List Administration Address when using Amazon SES. Make sure before you configure any of the above that you Verify this email address, just like you would a Amazon SES Sender. If you do not, your messages sent through Dada Mail will not be delivered.</p>

<h2 id="Testing">Testing</h2>

<p>To test out any of these configurations, Send yourself a test message through Dada Mail and view the source of the message itself, in your mail reader. In the mail headers, you should see the <b>Return-Path</b> header:</p>

<pre><code> Return-Path: &lt;dadabounce@myhost.com&gt;
 Delivered-To: justin@myhost.com
 Received: (qmail 75721 invoked from network); 12 May 2003 04:50:01 -0000
 Received: from myhost.com (208.10.44.140)
   by hedwig.myhost.com with SMTP; 12 May 2003 04:50:01 -0000
 Date:Sun, 11 May 2003 23:50:01 -0500
 From:justin &lt;justin@myhost.com&gt;
 Subject:Test, Test, Test
 To:justin@myhost.com
 Sender:dadabounce@myhost.com
 Reply-To:justin &lt;justin@myhost.com&gt;
 Precedence:list
 Content-type:text/plain; charset=iso-8859-1</code></pre>

<p>The first line has the <b>Return-Path</b> header should have the Bounce Handler Email set:</p>

<pre><code>        Return-Path: &lt;dadabounce@myhost.com&gt;</code></pre>

<p>In this example, my List Owner address, <b>justin@myhost.com</b> still occupies the <code>To:</code> and <code>Reply-To headers</code>, so whoever replies to my message will reply to me, <i>not</i> Bounce Handler.</p>

<h1 id="Configuring-the-Cronjob-to-Automatically-Run-Bounce-Handler">Configuring the Cronjob to Automatically Run Bounce Handler</h1>

<p>We&#39;re going to assume that you already know how to set up the actual cronjob, but we&#39;ll be explaining in depth on what the cronjob you need to set <b>is</b>.</p>

<h2 id="Setting-the-cronjob-via-curl">Setting the cronjob via curl</h2>

<p>Generally, setting the cronjob to have Bounce Handler run automatically, just means that you have to have a cronjob access a specific URL (via a utility, like curl). The URL looks something like this:</p>

<pre><code> http://example.com/cgi-bin/dada/plugins/bounce_handler.cgi?run=1&amp;verbose=1</code></pre>

<p>Where, <a href="http://example.com/cgi-bin/dada/plugins/bounce_handler.cgi">http://example.com/cgi-bin/dada/plugins/bounce_handler.cgi</a> is the URL to your copy of <code>bounce_handler.cgi</code></p>

<p>You&#39;ll see the specific URL used for your installation of Dada Mail in the web-based control panel for Bounce Handler, under the fieldset legend, <b>Manually Run Bounce Handler</b>, under the heading, <b>Manual Run URL:</b></p>

<p>This will have Bounce Handler check any awaiting messages.</p>

<p>A <i>Pretty Good Guess</i> of what the entire cronjob should be set to is located in the web-based crontrol panel for Bounce Handler, under the fieldset legend, <b>Manually Run Bounce Handler</b>, under the heading, <b>curl command example (for a cronjob):</b></p>

<h3 id="Customizing-your-cronjob-with-added-parameters">Customizing your cronjob with added parameters</h3>

<h4 id="passcode">passcode</h4>

<p>Since anyone (or anything) can run your Bounce Handler, by following that same URL, (<code>http://example.com/cgi-bin/dada/plugins/bounce_handler.cgi?run=1&amp;verbose=1</code>), you can set up a simple <b>Passcode</b>, to have some semblence of security over who runs the program.</p>

<p>Set a <b>passcode</b> in Bounce Handler&#39;s Config variable, <b>Manual_Run_Passcode</b>. This is done in your <code>.dada_config</code> file - the same place the <b>mail server</b>, <b>username</b> and <b>password</b> were set. Find the lines in your <code>.dada_config</code> file that look like this:</p>

<pre><code>        $PLUGIN_CONFIGS = { 
        
                Bounce_Handler =&gt; {
                        Server                      =&gt; &#39;mail.yourdomain.com&#39;, 
                        Username                    =&gt; &#39;bounces+yourdomain.com&#39;, 
                        Password                    =&gt; &#39;password&#39;, 
                        Port                        =&gt; undef,
                        USESSL                      =&gt; undef,
                        AUTH_MODE                   =&gt; undef,
                        Plugin_Name                 =&gt; undef,
                        Plugin_URL                  =&gt; undef,
                        Allow_Manual_Run            =&gt; undef,
                        Manual_Run_Passcode         =&gt; undef,
                        Enable_POP3_File_Locking    =&gt; undef, 
                        Log                         =&gt; undef,
                        MessagesAtOnce              =&gt; undef,
                        Max_Size_Of_Any_Message     =&gt; undef,
                        Rules                       =&gt; undef,
                        
                },</code></pre>

<p>Find the config parameter named, <b>Manual_Run_Passcode</b> and set it to whatever you&#39;d like this Passcode to be:</p>

<pre><code>                Manual_Run_Passcode         =&gt; &#39;sneaky&#39;,</code></pre>

<p>Then change the URL to include this passcode. In our examples, it would then look like this:</p>

<pre><code> http://example.com/cgi-bin/dada/plugins/bounce_handler.cgi?run=1&amp;passcode=sneaky</code></pre>

<p>The example cronjob for curl in Bounce Handler&#39;s list control panel should also update use the new passcode.</p>

<h3 id="messages">messages</h3>

<p>Sets how many messages should be checked and parsed in one execution of the program. Example:</p>

<pre><code> http://example.com/cgi-bin/dada/plugins/bounce_handler.cgi?run=1&amp;messages=10</code></pre>

<h3 id="verbose">verbose</h3>

<p>When set to, <b>1</b>, you&#39;ll receive the a report of how Bounce Handler is doing parsing and adding scores (and what not). This is sometimes not so desired, especially in a cron environment, since all this informaiton will be emailed to you (or someone) everytime the script is run.</p>

<p>If you set <b>verbose</b> to, &quot;0&quot;, under normal operation, Bounce Handler won&#39;t show any output, but if there&#39;s a server error, you&#39;ll receive an email about it. This is probably a good thing. Example (for cronjob-run curl command):</p>

<pre><code> * * * * * /usr/local/bin/curl -s --get --data run=1\;verbose=0 --url http://example.com/cgi-bin/dada/plugins/bounce_handler.cgi</code></pre>

<h3 id="test">test</h3>

<p>Runs Bounce Handler in test mode by checking the bounces and parsing them, but not actually carrying out any rules (no scores added, no email addresses unsubscribed).</p>

<h1 id="Command-Line-Interface">Command Line Interface</h1>

<p>There&#39;s a slew of optional arguments you can give to this script. To use Bounce Handler via the command line, first change into the directory that Bounce Handler resides in, and issue the command:</p>

<pre><code> ./bounce_handler.cgi --help</code></pre>

<p>For a full list of parameters.</p>

<p>You may set the cronjob via the command line interface, rather than the web-based way. You may run into file permission problems when running it this way, depending on your server setup.</p>

<h2 id="Command-Line-Interface-for-Cronjobs">Command Line Interface for Cronjobs:</h2>

<p>The secret is to actually have two commands in one. The first command changes into the same directory as the <code>bounce_handler.cgi</code> script, the second invokes the script with the parameters you&#39;d like.</p>

<p>For example:</p>

<pre><code> */5 * * * * cd /home/myaccount/cgi-bin/dada/plugins; /usr/bin/perl ./bounce_handler.cgi  &gt;/dev/null 2&gt;&amp;1</code></pre>

<p>Where, <i>/home/myaccount/cgi-bin/dada/plugins</i> is the full path to the directory the <code>dada_bounc_handler.pl</code> script resides.</p>

<h1 id="Plugin-Configs">Plugin Configs</h1>

<p>These plugin configs are located in your <code>.dada_config</code> file, as mentioned above.</p>

<h2 id="Server-Username-Password">Server, Username, Password</h2>

<p>These configs need to be set, to hook Bounce Handler to the email address you want the bounce messages to go.</p>

<h2 id="Port">Port</h2>

<p>Defaults to: <b>110</b> for regular connections, <code>995</code> for SSL connections.</p>

<p>Sets the <b>port</b> Bounce Handler uses connect to the POP server.</p>

<h2 id="USESSL">USESSL</h2>

<p>Defaults to: <b>0</b>. Set to, <b>1</b>, if you&#39;d like (and can) connect to the POP server with an SSL connection.</p>

<h2 id="AUTH_MODE">AUTH_MODE</h2>

<p>Defaults to: <b>BEST</b></p>

<p>Allowed parameters: <b>BEST</b>, <b>PASS</b>, <b>APOP</b>, <b>CRAM-MD5</b>.</p>

<p>If the default of, <b>BEST</b> isn&#39;t working, try the various allowed parameters. <b>PASS</b> passes the POP3 password in cleartext.</p>

<ul>

<li><p>BEST</p>

<p>Tries, <b>APOP</b>, <b>CRAM-MD5</b> and <b>PASS</b> modes, in that order of availability.</p>

</li>
</ul>

<h2 id="Plugin_Name">Plugin_Name</h2>

<p>The name of this plugin.</p>

<p>Defaults to: <b>Bounce Handler</b></p>

<h2 id="Plugin_URL">Plugin_URL</h2>

<p>The URL of the plugin. This is usually figured out by default, but if it&#39;s not (you&#39;ll know, as links are broken in the plugin and nothing seems to work) you may have to set this, manually.</p>

<h2 id="Allow_Manual_Run">Allow_Manual_Run</h2>

<p>Defaults to <b>1</b> (enabled)</p>

<p>Sets whether you may use the <b>manual run URL</b> to run Bounce Handler. The manual run URL is what the curl-powered cronjob uses. If you want to disable this method, set this config variable to, <b>0</b></p>

<h2 id="Manual_Run_Passcode">Manual_Run_Passcode</h2>

<p>This is covered above, under, <b>passcode</b></p>

<h2 id="Enable_POP3_File_Locking">Enable_POP3_File_Locking</h2>

<p>Defaults to <b>1</b></p>

<p>When enabled, Bounce Handler will use a lock file to make sure only one connection to the POP server is done at one time. Disable this by setting this parameter to, <b>0</b>.</p>

<h2 id="Log">Log</h2>

<p>Sets the path to the logfile Bounce Handler creates. Defaults to: <code>bounces.txt</code> in your <code>.dada_files/.logs</code> directory.</p>

<h2 id="MessagesAtOnce">MessagesAtOnce</h2>

<p>Sets how many messages are checke, per running of the plugin.</p>

<p>Defaults to: <b>100</b></p>

<p>Since there could be many bounce messages awaiting to be checked, there is a limit that&#39;s set on how many mesages are looked at, at one time. This also means that it may take a few runnings of the plugin to clear all the awaiting messages.</p>

<h3 id="Max_Size_Of_Any_Message">Max_Size_Of_Any_Message</h3>

<p>Defaults to: <b>2,621,440</b> bytes (2.5 megs). Set in, <b>octets</b></p>

<p>Sets the maximum size of any bounced message that Bounce Handler will deal with. Anything larger than this will simply be ignored and deleted.</p>

<h1 id="More-on-Scores-Thresholds-etc">More on Scores, Thresholds, etc</h1>

<p>By default, Bounce Handler assigns a particular score to each email address that bounces back a message. These scores are tallied each time an email address bounces a message.</p>

<p>Since Dada Mail understands the differences between <b>Hard Bounces</b> and <b>Soft Bounces</b>, it&#39;ll append a smaller score for soft bounces, and a larger score for hard bounces. There&#39;s also a <b>Decay Rate</b>, an amount that all scores are decreased by, every time a mass mailing is sent out.</p>

<p>Once the email address&#39;s <b>Bounce Score</b> reaches the <b>Threshold</b>, the email address is then removed from the list.</p>

<h1 id="Special-Debugging-Mode">Special Debugging Mode</h1>

<h2 id="manually_enter_bounces">manually_enter_bounces</h2>

<p>Visit the plugin with the following query string,</p>

<p><a href="http://example.com/cgi-bin/dada/plugins/bounce_handler.cgi?flavor=manually_enter_bounces">http://example.com/cgi-bin/dada/plugins/bounce_handler.cgi?flavor=manually_enter_bounces</a></p>

<p>(<code>manually_enter_bounces</code>) to enter a special debugging mode, where you can just paste in the source of a bounce message, and see how Bounce Handler will handle it, without actually processing the message.</p>

<h1 id="FAQs">FAQs</h1>

<h2 id="Bounce-Email-Address">Bounce Email Address</h2>

<h3 id="Do-you-use-only-one-Bounce-Email-Address-for-all-the-mailing-lists">Do you use only one Bounce Email Address for all the mailing lists?</h3>

<p>Yes.</p>

<p>Even though there&#39;s only one Bounce Email Address, it is used by all the mailing lists of your Dada Mail, but Bounce Handler will work with every mailing list <i>individually</i>. Each mailing list also has a separate Bounce Scorecard.</p>

<h1 id="Introduction-to-Bounce-Handler-Rules">Introduction to Bounce Handler Rules</h1>

<p>Bounce Handler Rules are what&#39;s used when the bounced message is parsed and examined. They&#39;re a set of things to look for, and match, in an attempt to figure out what type of bounced message was given back.</p>

<p>An example Rule:</p>

<pre><code>     {
        exim_user_unknown =&gt; { 
            Examine =&gt; { 
                Message_Fields =&gt; { 
                    Status      =&gt; [qw(5.x.y)], 
                    Guessed_MTA =&gt; [qw(Exim)],  
                }, 
                Data =&gt; { 
                    Email       =&gt; &#39;is_valid&#39;,
                    List        =&gt; &#39;is_valid&#39;, 
                }
            },
                Action =&gt; { 
                     add_to_score =&gt; &#39;hardbounce_score&#39;,
                }, 
            }
    }, </code></pre>

<p><b>exim_user_unknown</b> is the title of the rule - just a label, nothing else.</p>

<p><b>Examine</b> holds a set of parameters that the handler looks at when trying to figure out what to do with a bounced message. This example has a <b>Message_Fields</b> entry and inside that, a <b>Status</b> entry. The <b>Status</b> entry holds a list of status codes. The ones in shown there all correspond to hard bounces; the mailbox probably doesn&#39;t exist.</p>

<p><b>Message_Fields</b> also hold a, <b>Guessed_MTA</b> entry - it&#39;s explicitly looking for a bounce back from the, <i>Exim</i> mail server.</p>

<p><b>Examine</b> also holds a <b>Data</b> entry, which holds the <b>Email</b> or <b>List</b> entries, or both. Their values are either &#39;is_valid&#39;, or &#39;is_invalid&#39;.</p>

<p>So, to sum this all up, this rule will match a message that has <b>Status:</b> <b>Message Field</b> contaning a user unknown error code, <b>(5.1.1, etc)</b> and also a <b>Guessed_MTA</b> <b>Message Field</b> containing, <b>Exim</b>. The message also has to be parsed to have found a valid email and list name.</p>

<p>If this all matches, the <b>Action</b> is... acted upon. In this case, the offending email address will be appended a, <b>Bounce Score</b> of, whatever, <b>hardbounce_score</b> is, which by is default, <b>4</b>.</p>

<p>If you would like to have the bounced address automatically removed, without any sort of scoring happening, change the <b>action</b> from,</p>

<pre><code>    add_to_score =&gt; &#39;hardbounce_score&#39;,</code></pre>

<p>to:</p>

<pre><code>    unsubscribe_bounced_email =&gt; &#39;from_list&#39;</code></pre>

<p>Also, changing <b>from_list</b>, to <b>from_all_lists</b> will do the trick.</p>

<p>Here&#39;s a schematic of all the different things you can do:</p>

<pre><code> {
 rule_name =&gt; {
         Examine =&gt; {
                Message_Fields =&gt; {
                        Status               =&gt; qw([    ]), 
                        Last-Attempt-Date    =&gt; qw([    ]), 
                        Action               =&gt; qw([    ]), 
                        Status               =&gt; qw([    ]), 
                        Diagnostic-Code      =&gt; qw([    ]), 
                        Final-Recipient      =&gt; qw([    ]), 
                        Remote-MTA           =&gt; qw([    ]), 
                        # etc, etc, etc
                        
                },
                Data =&gt; { 
                        Email =&gt; &#39;is_valid&#39; | &#39;is_invalid&#39; 
                        List  =&gt; &#39;is_valid&#39; | &#39;is_invalid&#39; 
                }
        },
        Action =&gt; { 
                   add_to_score             =&gt;  $x, # where, &quot;$x&quot; is a number
                           unsubscribe_bounced_email =&gt; &#39;from_list&#39; | &#39;from_all_lists&#39;,
        },
 },     </code></pre>

<p>Rules also support the use of regular expressions for matching any of the <b>Message_Fields</b>.</p>

<p>To tell the parser that you&#39;re using a regular expression, make the Message_Field key end in &#39;_regex&#39;:</p>

<pre><code> &#39;Final-Recipient_regex&#39; =&gt; [(qr/RFC822/)], </code></pre>

<h2 id="Customizing-Bounce-Handler-Rules">Customizing Bounce Handler Rules</h2>

<p>The default set of Bounce Handler Rules can be found at,</p>

<p><i>dada/data/bounce_handler_rules.pl</i></p>

<p>Bounce Handler will also look for a copy of this file in your</p>

<p><i>.dada_files/.configs</i></p>

<p>directory, which you can then customize with your own rules. When Dada Mail is upgrading, your customizations will then not be lost.</p>

<h1 id="COPYRIGHT">COPYRIGHT</h1>

<p>Copyright (c) 1999 - 2014 Justin Simoni http://justinsimoni.com All rights reserved.</p>

<p>This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.</p>

<p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</p>

<p>You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.</p>

<p>Parts of this script were swiped from Mail::Bounce::Qmail module, fetched from here:</p>

<p>http://mikoto.sapporo.iij.ad.jp/cgi-bin/cvsweb.cgi/fmlsrc/fml/lib/Mail/Bounce/Qmail.pm</p>

<p>The copyright of that code stated:</p>

<p>Copyright (C) 2001,2002,2003 Ken&#39;ichi Fukamachi All rights reserved. This program is free software; you can redistribute it and/or modify it under the same terms as Perl itself.</p>

<p>Thanks Ken&#39;ichi</p>


</body>

</html>


